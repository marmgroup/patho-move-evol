---
output: html_document
editor_options: 
  chunk_output_type: console
---

# Plot networks in final generations

```{r}
library(data.table)
library(tidygraph)
library(ggraph)
library(colorspace)
```

```{r}
load("data/results/data_networks.Rds")
# get last gen
ntwks = lapply(data_ntwk, last)
```

```{r}
labels = c(
  "0" = "Sc. 1: No pathogen",
  "1" = "Sc. 2: Endemic pathogen",
  "2" = "Sc. 3: Spillover pathogen"
)
```

## Network plots

```{r}
ntwks_basic = ntwks[c(1, 9)]
# ntwks = lapply(ntwks, last)
ntwks_basic$nopatho = ntwks_basic$nopatho %>% 
  activate(edges) %>% 
  filter(weight > 25) %>% 
  activate(nodes)
```


```{r}
networkplots_basic = lapply(
  ntwks_basic, function(n) {
    ggraph(n, x = x, y = y)+
      geom_edge_fan(
        edge_width = 0.2,
        edge_alpha = 0.2,
        edge_color = "grey50"
      )+
      geom_node_point(
        aes(
          fill = t_infec, 
          size = assoc
        ),
        shape = 21,
        # size = 3,
        alpha = 1,
        show.legend = F
      )+
      scale_shape_manual(
        values = c(21, 22, 23, 24)
      )+
      scale_fill_continuous_sequential(
        palette = "Heat 2",
        limit = c(1, NA),
        # direction = -1,
        na.value = "lightblue"
        # trans = "sqrt"
      )+
      theme_graph(
        background = "white"
      )+
      theme(
        legend.position = "top"
      )
  })

networkplots_basic = wrap_plots(networkplots_basic, ncol = 2)
```

## Data SIR

```{r}
data_sir_basic = fread("data/results/data_sir_basic.csv")
data_sir_basic = data_sir_basic[class != "NS",]
data_sir_basic[, time_round := plyr::round_any(time, 0.5)]
# data_sir_basic = data_sir_basic[, list(
#   mean = mean(mean),
#   sd = sd(mean)
# ), by = c("")]
```

```{r}
ggplot(data_sir_basic[class == "NR" & gamma == 1 & beta == 6])+
  stat_summary(
    aes(
      time_round, mean,
      colour = class, 
      group = interaction(class, repl, sc_repl, scenario)
    ),
    geom = "line"
  )+
  facet_grid(sc_repl~scenario)
```

