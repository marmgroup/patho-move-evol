---
editor_options: 
  chunk_output_type: console
---
  
# Plot networks and SIR models
  
```{r}
library(data.table)
library(ggplot2)

library(patchwork)
library(colorspace)
```

```{r}
labels = c(
  "nopatho" = "Sc. 1: No pathogen",
  "endemic" = "Sc. 2: Endemic pathogen",
  "spillover" = "Sc. 3: Spillover pathogen"
)
```


## Basic scenarios

```{r}
sir_basic = fread("data/results/data_sir_basic.csv")
sir_basic$mean = sir_basic$mean / 500
sir_basic = sir_basic[gamma == 1]
sir_basic[, tround := plyr::round_any(time, 1)]
sir_basic$scenario = factor(sir_basic$scenario, 
                            levels = c("nopatho", "endemic"))
```


```{r}
# plot_sir_basic =
  ggplot(sir_basic[class == "NR"])+
  geom_bin2d(
    aes(
      time, mean
    ),
    # binwidth = c(0.25, 0.02),
    show.legend = F
  )+
  stat_summary(
    fun = mean,
    fun.max = ci_upper,
    fun.min = ci_lower,
    aes(
      tround, mean,
    ),
    show.legend = F,
    alpha = 0.8,
    colour = "grey30"
  )+
  scale_fill_continuous_sequential(
    palette = "Reds",
    # rev = F,
    trans = "sqrt"
  )+
  theme_test()+
  theme(
    strip.background = element_blank(),
    strip.text = element_text(
      face = "italic"
    ),
    axis.text.y = element_text(
      angle = 90,
      hjust = 0.5
    ),
  )+
  facet_grid(
    beta~scenario,
    scales = "free",
    labeller = labeller(
      scenario = labels
    )
  )+
  scale_x_sqrt(
    breaks = c(0, 1, seq(5, 15, 5))
  )+
  scale_y_continuous(
    labels = scales::percent,
    breaks = c(0.01, 0.5, 1)
  )+
  coord_cartesian(
    expand = T,
    # xlim = c(0, 5),
    ylim = c(0, 1)
  )+
  labs(
    x = "SIR simulation time",
    y = "% Agents"
  )
```


## Spillover

```{r}
# spillover data and rounding
sir_spillover = fread("data/results/data_sir_spillover.csv")
sir_spillover$mean = sir_spillover$mean / 500
sir_spillover = sir_spillover[gamma == 1]
sir_spillover[, tround := plyr::round_any(time, 1)]
```

```{r}
ggplot(sir_spillover[class == "NR"])+
  geom_bin2d(
    aes(
      time, mean
    ),
    # binwidth = c(0.25, 0.02),
    show.legend = F
  )+
  stat_summary(
    fun = mean,
    fun.max = ci_upper,
    fun.min = ci_lower,
    aes(
      tround, mean,
    ),
    show.legend = F,
    alpha = 0.8,
    colour = "grey30"
  )+
  scale_fill_continuous_sequential(
    palette = "Reds",
    # rev = F,
    trans = "sqrt"
  )+
  theme_bw()+
  theme(
    strip.background = element_blank(),
    strip.text = element_text(
      face = "italic"
    ),
    axis.text.y = element_text(
      angle = 90,
      hjust = 0.5
    ),
  )+
  facet_grid(
    beta~type,
    scales = "free",
    labeller = labeller(
      scenario = labels
    )
  )+
  scale_x_sqrt(
    breaks = c(0, 1, seq(5, 15, 5))
  )+
  scale_y_continuous(
    labels = scales::percent,
    breaks = c(0.01, 0.5, 1)
  )+
  coord_cartesian(
    expand = T,
    # xlim = c(0, 5),
    ylim = c(0, 1)
  )+
  labs(
    x = "SIR simulation time",
    y = "% Agents"
  )
```

