---
editor_options: 
  chunk_output_type: console
---

# Plot evolutionary consequences of spillover

```{r}
library(data.table)

library(ggplot2)
library(patchwork)
library(colorspace)

# custom functions
devtools::load_all()
```

Load data.

```{r}
data = fread("data/results/data_si_morphs.csv")
data = data[social_strat != "non-handler tracking"]

# summarise
data[, gen_round := plyr::round_any(gen, 25)]
# handle for 5 replicates, and 5 obs over 25 gens
data_si_evo = data[, list(sum = sum(N) / (500 * 5 * 5)), 
                   by = c("social_strat", "cost", "regen", "gen_round")]

# levels of productivity
data_si_evo[, regen := factor(regen, levels = c("100", "50", "20"))]
```

```{r}
fig1 =
  ggplot(data_si_evo)+
  geom_area(
    aes(
      gen_round, sum, 
      fill = social_strat
    )
  )+
  geom_vline(
    xintercept = 3334,
    lty = 2,
    size = 0.3
    # col = c("grey", "black", "grey")
  )+
  scale_fill_discrete_sequential(
    palette = "Viridis", 
    rev = F,
    l1 = 30,
    name = NULL,
    labels = stringr::str_to_sentence
  )+
  scale_x_continuous(
    breaks = 3334,
    labels = "Pathogen introduction",
    name = "Increasing productivity \u279c",
    sec.axis = dup_axis(
      breaks = c(1000, 3000, 5000),
      labels = scales::comma_format(
        accuracy = 1
        # scale = 1/1000, suffix = "K"
      ),
      name = "Generations"
    )
  )+
  scale_y_continuous(
    labels = scales::percent,
    breaks = NULL,
    name = glue::glue("Increasing disease cost \u279c"),
    sec.axis = dup_axis(
      breaks = c(0.1, 0.5, 0.9),
      labels = scales::percent,
      name = "% Individuals"
    )
  )+
  facet_grid(
    cost ~ regen, 
    as.table = F, 
    switch = c("both"),
    labeller = labeller(
      cost = function(x) sprintf("Î´E = %s", x),
      regen = function(x) sprintf("T<sub>R</sub> = %s", x)
    )
  )+
  coord_cartesian(
    expand = F,
    # ylim = c(0, 1),
    xlim = c(1, 5000)
  )+
  theme_test(
    base_size = 11,
    base_family = "Arial"
  )+
  theme(
    legend.position = "top", 
    legend.key.height = unit(1, "mm"),
    strip.placement = "outside",
    strip.text = ggtext::element_markdown(),
    axis.text.x = element_text(hjust = 0.5, size = 8)
  )

ggsave(
  plot = fig1,
  filename = "figures/fig_01.png",
  height = 114, width = 114, units = "mm"
)
```
