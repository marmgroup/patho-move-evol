---
editor_options: 
  chunk_output_type: console
---

# Plot energy and movement outcomes

```{r}
library(data.table)
library(ggplot2)
library(patchwork)
library(colorspace)
```

Load data.

```{r}
files = list.files(path = "data/results/", pattern = "gen", full.names = T)
scenario = grep(pattern = "\\d{1}", files)
```

```{r}
data = Map(files, scenario, f = function(file, sc) {
  df = fread(file)
  df$scenario = sc
  df
})

data = rbindlist(data)

data_summary = copy(data)
data_summary[, gen_round := plyr::round_any(gen, 500)]
```

```{r}
labels = c(
  "1" = "Sc. 1: No pathogen",
  "2" = "Sc. 2: Endemic pathogen",
  "3" = "Sc. 3: Spillover pathogen"
)
```

## Plot energy

```{r}
plot_energy =
  ggplot(data)+
  geom_bin_2d(
    aes(
      gen, mean_energy, 
      # group = interaction(scenario, repl)
    ),
    alpha = 0.6,
    show.legend = F
  )+
  stat_summary(
    data = data_summary,
    fun = mean, 
    fun.min = function(x) {quantile(x, 0.05)}, 
    fun.max = function(x) {quantile(x, 0.95)},
    aes(
      gen_round, mean_energy,
      # colour = as.factor(scenario),
      # group = interaction(scenario, repl)
    ),
    show.legend = F
  )+
  geom_vline(
    data = data.table(
      x = 0.667 * 5000,
      scenario = 3
    ),
    aes(
      xintercept = x
    ),
    lty = 2
  )+
  scale_fill_continuous_sequential(
    palette = "Heat 2"
  )+
  scale_x_continuous(
    # trans = "sqrt",
    breaks = c(1, 1000, 2500, 5000),
    labels = scales::comma
  )+
  facet_wrap(
    ~scenario,
    labeller = labeller(
      scenario = labels
    ),
    scales = "free"
  )+
  theme_classic(
    base_size = 10
  )+
  theme(
    strip.background = element_blank(),
    strip.text = element_text(
      face = "italic"
    ),
    panel.grid.major = element_line(
      size = 0.2
    )
  )+
  coord_cartesian(
    ylim = c(0, 5)
  )+
  labs(
    x = "Generation",
    y = "Mean per-capita intake"
  )
```

## Plot movement

```{r}
plot_movement =
  ggplot(data)+
  geom_bin_2d(
    aes(
      gen, mean_moved, 
      # group = interaction(scenario, repl)
    ),
    alpha = 0.7,
    show.legend = F
  )+
  stat_summary(
    data = data_summary,
    fun = mean, 
    fun.min = function(x) {quantile(x, 0.05)}, 
    fun.max = function(x) {quantile(x, 0.95)},
    aes(
      gen_round, mean_moved,
      # colour = as.factor(scenario),
      # group = interaction(scenario, repl)
    ),
    # position = position_jitter(),
    show.legend = F,
  )+
  geom_vline(
    data = data.table(
      x = 0.667 * 5000,
      scenario = 3
    ),
    aes(
      xintercept = x
    ),
    lty = 2
  )+
  scale_fill_continuous_sequential(
    palette = "Blues 3",
    rev = T,
    na.value = "transparent"
  )+
  scale_x_continuous(
    # trans = "sqrt",
    breaks = c(1, 1000, 2500, 5000),
    labels = scales::comma
  )+
  facet_wrap(
    ~scenario,
    labeller = labeller(
      scenario = labels
    ),
    scales = "free"
  )+
  theme_classic(
    base_size = 10
  )+
  theme(
    strip.background = element_blank(),
    strip.text = element_text(
      face = "italic"
    ),
    panel.grid.major = element_line(
      size = 0.2
    )
  )+
  coord_cartesian(
    ylim = c(80, 96),
  )+
  labs(
    x = "Generation",
    y = "Mean distance moved"
  )
```

## Make Figure 1

```{r}
fig_1 = wrap_plots(
  plot_movement,
  plot_energy, 
  ncol = 1
) &
  plot_annotation(
    tag_levels = c("A", 1)
  ) &
  theme(
    plot.tag = element_text(
      face = "bold",
      size = 10
    )
  )

ggsave(
  fig_1,
  filename = "figures/fig_01.png",
  height = 5,
  width = 6
)
```

