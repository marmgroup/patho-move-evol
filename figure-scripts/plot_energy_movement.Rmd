---
editor_options: 
  chunk_output_type: console
---

# Plot intake and movement outcomes

```{r}
library(data.table)

library(ggplot2)
library(patchwork)
library(colorspace)
```

Load data.

```{r}
data = fread("data/results/data_gen.csv")
data[, scenario := fcase(
  scenario == "nopatho", 1,
  scenario == "endemic", 2,
  scenario == "spillover", 3
)]
data[, gen_round := plyr::round_any(gen, 400)]
data[, energy.mean := fifelse(scenario == 1, NA_real_, energy.mean)]
data[, energy.mean := fifelse(scenario == 3 & gen < 3334, NA_real_, energy.mean)]
```

```{r}
labels = c(
  "1" = "Sc. 1: No pathogen",
  "2" = "Sc. 2: Endemic pathogen",
  "3" = "Sc. 3: Spillover pathogen"
)
```

## Plot intake

```{r}
plot_intake =
  ggplot(data)+
  geom_bin2d(
    aes(
      gen, intake.mean,
    ),
    binwidth = c(100, 0.25),
    show.legend = F
  )+
  stat_summary(
    fun = mean,
    fun.min = ci_lower,
    fun.max = ci_upper,
    aes(
      gen_round, intake.mean,
      group = interaction(scenario),
      colour = "Intake"
    ),
    shape = 16, alpha = 0.8
  )+
  stat_summary(
    fun = mean,
    fun.min = ci_lower,
    fun.max = ci_upper,
    aes(
      gen_round, energy.mean,
      group = interaction(scenario),
      colour = "Energy"
    ),
    shape = 17, alpha = 0.8
  )+
  scale_fill_continuous_sequential(
    palette = "Greens 2"
  )+
  scale_colour_discrete_qualitative(
    palette = "Dark 2", l1 = 20
  )+
  scale_x_continuous(
    breaks = c(1, 1000, 2500, 5000),
    labels = scales::comma
  )+
  geom_hline(
    yintercept = 0,
    size = 0.2,
    lty = 2
  )+
  geom_vline(
    data = data.table(
      x = 0.667 * 5000,
      scenario = 3
    ),
    aes(
      xintercept = x
    ),
    lty = 2,
    size = 0.2
  )+
  facet_wrap(
    ~scenario,
    labeller = labeller(
      scenario = labels
    ),
    scales = "free"
  )+
  theme_test()+
  theme(
    legend.position = "bottom",
    strip.background = element_blank(),
    strip.text = element_text(
      face = "italic"
    )
  )+
  coord_cartesian(
    ylim = c(-1, 15)
  )+
  labs(
    x = "Generation",
    y = "Mean per-capita intake",
    colour = NULL
  )
```

## Plot movement

```{r}
plot_movement =
  ggplot(data)+
  geom_bin2d(
    aes(
      gen, moved.mean,
    ),
    binwidth = c(100, 1),
    show.legend = F
  )+
  stat_summary(
    fun = mean,
    fun.min = ci_lower,
    fun.max = ci_upper,
    aes(
      gen_round, moved.mean,
      group = interaction(scenario),
      colour = "Distance"
    ),
    show.legend = F,
    shape = 15, alpha = 0.8
  )+
  geom_vline(
    data = data.table(
      x = 0.667 * 5000,
      scenario = 3
    ),
    aes(
      xintercept = x
    ),
    lty = 2,
    size = 0.2
  )+
  scale_colour_discrete_qualitative(
    palette = "Cold", l1 = 20
  )+
  scale_fill_continuous_sequential(
    palette = "Blues 2"
  )+
  scale_x_continuous(
    breaks = c(1, 1000, 2500, 5000),
    labels = scales::comma
  )+
  facet_wrap(
    ~scenario,
    labeller = labeller(
      scenario = labels
    ),
    scales = "free"
  )+
  theme_test()+
  theme(
    strip.background = element_blank(),
    strip.text = element_text(
      face = "italic"
    )
  )+
  coord_cartesian(
    ylim = c(35, 90),
  )+
  labs(
    x = "Generation",
    y = "Mean distance moved",
    colour = NULL
  )
```

## Make Figure 1

```{r}
fig_1 =
wrap_plots(
  plot_intake, 
  plot_movement,
  ncol = 1,
  guides = "collect"
) &
  plot_annotation(
    tag_levels = c("A", 1)
  ) &
  theme(
    legend.position = "top",
    legend.key.height = unit(1, units = "mm"),
    plot.tag = element_text(
      face = "bold",
      size = 10
    )
  )

ggsave(
  fig_1,
  filename = "figures/fig_01.png",
  height = 5,
  width = 5.5
)
```

