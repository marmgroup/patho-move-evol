---
editor_options: 
  chunk_output_type: console
---

# Plot social strategies

```{r}
library(data.table)
library(ggplot2)
library(patchwork)
library(colorspace)
```

Load data.

```{r}
data = fread("data/results/data_morphs.csv")
data[, gen_round := plyr::round_any(gen, 500)]
```

Get social information data.

```{r}
data_si = data[, list(prop = .N / 500), 
               by = c("gen", "social_strat", "scenario", "repl", "gen_round")]
data_si[, scenario := fcase(
  scenario == "nopatho", 1,
  scenario == "endemic", 2,
  scenario == "spillover", 3
)]
```

```{r}
labels = c(
  "1" = "Sc. 1: No pathogen",
  "2" = "Sc. 2: Endemic pathogen",
  "3" = "Sc. 3: Spillover pathogen"
)
```

## Plot agent avoidance

```{r}
plot_agent_avoid =
  ggplot(
    data = data_si[social_strat == "agent avoiding",]
  )+
  stat_summary(
    fun = median,
    fun.min = function(x) {quantile(x, 0.05)}, 
    fun.max = function(x) {quantile(x, 0.95)},
    aes(
      gen_round, prop,
      colour = as.factor(scenario),
      shape = as.factor(scenario)
    ),
    position = position_dodge(width = 100),
    show.legend = F
  )+
  scale_colour_discrete_qualitative(
    palette = "Harmonic",
    l1 = 50,
    order = c(3, 1, 2),
    name = NULL,
    labels = c(
      "1" = "Sc. 1: No pathogen",
      "2" = "Sc. 2: Endemic pathogen",
      "3" = "Sc. 3: Spillover pathogen"
    )
  )+
  scale_shape(
    name = NULL,
    labels = c(
      "1" = "Sc. 1: No pathogen",
      "2" = "Sc. 2: Endemic pathogen",
      "3" = "Sc. 3: Spillover pathogen"
    )
  )+
  scale_x_continuous(
    # trans = "sqrt",
    breaks = c(1, 1000, 2500, 5000),
    labels = scales::comma
  )+
  scale_y_continuous(
    labels = scales::percent
  )+
  geom_vline(
    data = data.table(
      x = 0.667 * 5000,
      scenario = 3
    ),
    aes(
      xintercept = x
    ),
    lty = 2
  )+
  coord_cartesian(
    ylim = c(0, 1)
  )+
  facet_wrap(
    vars(scenario),
    labeller = labeller(
      scenario = labels
    ),
    scales = "free"
  )+
  theme_classic(
    base_size = 10
  )+
  theme(
    strip.background = element_blank(),
    strip.text = element_text(
      face = "italic"
    ),
    legend.background = element_blank(),
    legend.position = "top",
    panel.grid.major.y = element_line(
      size = 0.2
    )
  )+
  labs(
    y = "% Agents avoiding all agents",
    x = "Generation"
  )
```

## Plot associations

```{r}
data = fread("data/results/data_gen.csv")
data[, scenario := fcase(
  scenario == "nopatho", 1,
  scenario == "endemic", 2,
  scenario == "spillover", 3
)]
data[, gen_round := plyr::round_any(gen, 500)]
```


```{r}
plot_assoc =
  ggplot(data)+
  stat_summary(
    fun = median,
    fun.min = function(x) {quantile(x, 0.05)}, 
    fun.max = function(x) {quantile(x, 0.95)},
    aes(
      gen_round, assoc.mean,
      colour = as.factor(scenario),
      shape = as.factor(scenario)
    ),
    position = position_dodge(width = 100),
    show.legend = F
  )+
  geom_vline(
    data = data.table(
      x = 0.667 * 5000,
      scenario = 3
    ),
    aes(
      xintercept = x
    ),
    lty = 2
  )+
  scale_colour_discrete_qualitative(
    palette = "Harmonic",
    l1 = 50,
    order = c(3, 1, 2),
    name = NULL,
    labels = c(
      "1" = "Sc. 1: No pathogen",
      "2" = "Sc. 2: Endemic pathogen",
      "3" = "Sc. 3: Spillover pathogen"
    )
  )+
  scale_shape(
    name = NULL,
    labels = c(
      "1" = "Sc. 1: No pathogen",
      "2" = "Sc. 2: Endemic pathogen",
      "3" = "Sc. 3: Spillover pathogen"
    )
  )+
  scale_x_continuous(
    breaks = c(1, 1000, 2500, 5000),
    labels = scales::comma
  )+
  scale_y_continuous(
    trans = "log10",
    labels = scales::comma
  )+
  facet_wrap(
    vars(scenario),
    labeller = labeller(
      scenario = labels
    ),
    scales = "free"
  )+
  theme_classic(
    base_size = 10
  )+
  theme(
    strip.background = element_blank(),
    strip.text = element_text(
      face = "italic"
    ),
    panel.grid.major = element_line(
      size = 0.2
    ),
    legend.position = "top"
  )+
  coord_cartesian(
    expand = T,
    ylim = c(50, 20e3)
  )+
  labs(
    x = "Generation",
    y = "Mean per-capita encounters",
    fill = NULL
  )
```

```{r}
fig_2 = wrap_plots(
  plot_agent_avoid,
  plot_assoc,
  ncol = 1,
  guides = "collect"
) &
  theme(legend.position = "top")

ggsave(
  fig_2,
  filename = "figures/fig_02.png",
  height = 5,
  width = 6
)
```

