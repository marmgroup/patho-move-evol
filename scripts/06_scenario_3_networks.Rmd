---
editor_options: 
  chunk_output_type: console
---
  
# Networks at equilibrium: Scenario 3
  
```{r}
library(data.table)
library(igraph)
library(tidygraph)

library(ggplot2)
library(ggraph)
```


```{r}
# load files
files = list.files("data/output/", pattern = "spillover", full.names = T)
data_ntwk = vector("list", length = length(files))
repl = c()
spread = c()
for (i in seq(length(files))) {
  load(files[i])
  
  # filter edge lists for 0 interactions
  el = data[["edgeLists"]]
  el = el[[length(el)]]
  el = setDT(el[el$assoc > 5,])
  setnames(el, c("from", "to", "weight"))
  el = el[from != to]
  # increment el to and from by 1
  el$to = el$to + 1
  el$from = el$from + 1
  
  # get nodes and attributes
  nodes = data[["gen_data"]][["pop_data"]]
  nodes = nodes[[length(nodes)]]
  nodes$id = seq(nrow(nodes))
  
  # scale node attributes and assign movement types
  # nodes = assign_movement_types(nodes)
  
  nodes = get_social_strategy(nodes)
  
  # make tidygraph
  g = tbl_graph(nodes = nodes, edges = el, directed = FALSE)
  
  # add metrics
  g = mutate(
    g,
    degree = tidygraph::centrality_degree(weights = weight),
    isolated = tidygraph::node_is_isolated()
  )
  
  data_ntwk[[i]] = g
  repl = c(repl, data[["replicate"]])
  spread = c(spread, data[["clusterSpread"]])
  
  rm(data, g, nodes, el)
}
```

### Plot networks

```{r}
g = data_ntwk[[1]]
plot(g,
     vertex.size = 3, vertex.color = "orange", vertex.label = NA, 
     edge.arrow.size = 0, 
     layout = layout.sphere
)

data_ntwk[[3]] |>
  # filter(!isolated) |>
  ggraph(layout = "fr")+
  geom_edge_link(
    edge_width = 0.2,
    edge_alpha = 0.2
  )+
  geom_node_point(
    aes(colour = strat_social),
    size = 2,
    alpha = 0.8
  )+
  scale_colour_manual(
    values = c(
      "agent avoiding" = "black",
      "agent tracking" = "blue",
      "handler tracking" = "gold",
      "non-handler tracking" = "red"
    ),
    name = "Social cues"
  )+
  theme(
    legend.position = "top"
  )

ggsave(
  filename = "figures/fig_network_sc3.png"
)
```